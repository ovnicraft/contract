<odoo>

    <menuitem id="menu_contracts_main" string="Contratos" name="Contratos"/>

    <menuitem id="menu_contract_documents" string="Contratos" name="Contratos" parent="menu_contracts_main"/>

    <menuitem id="contract.menu_action_account_analytic_overdue_all"
	      parent="menu_contract_documents"
	      action="contract.action_account_analytic_overdue_all"
	      sequence="99"
	      />

    <record id="view_account_analytic_contract_form" model="ir.ui.view">
	<field name="name">view.contract.extended.form</field>
	<field name="model">account.analytic.account</field>
	<field name="arch" type="xml">
	    <form>
		<header>
		    <field name="state" widget="statusbar"/>
		    <button name="action_contract_send" type="object" string="Send by Email" groups="base.group_user"/>
		</header>
		<sheet string="Contrato">
		    <div class="oe_button_box" name="button_box">
			<button class="oe_stat_button" type="object" name="toggle_active" icon="fa-archive">
			    <field name="active" widget="boolean_button"
				   options='{"terminology": "archive"}'/>
			</button>
		    </div>
		    <div class="oe_title">
			<label for="name" class="oe_edit_only" string="Contrato"/>
			<h1>
			    <field name="name" class="oe_inline" placeholder="ejem. Contrato por Servicios"/>
			</h1>
		    </div>
		    <group name="main">
			<group>
			    <field name="code"/>
			    <field name="partner_id"/>
			    <field name="date_start"
				   attrs="{'required': [('recurring_invoices', '=', True)]}"
				   />
			    <field name="date_end"/>
			</group>
			<group>
			    <field name="tag_ids" widget="many2many_tags"/>
			    <field name="manager_id"/>
			    <field name="amount_total"/>
			    <field name="company_id" options="{'no_create': True}" groups="base.group_multi_company"/>
			    <field name="currency_id" options="{'no_create': True}" groups="base.group_multi_currency"/>
			</group>
			<field name="contract_template_id" colspan="4"/>
		    </group>

		<label string="Servicios/Productos Contratados" for="recurring_invoice_line_ids"
		       attrs="{'invisible': [('recurring_invoices','=',False)]}"
		       />
		<div attrs="{'invisible': [('recurring_invoices','=',False)]}">
		    <field name="recurring_invoice_line_ids">
			<tree string="Account Analytic Lines" editable="bottom">
			    <field name="sequence" widget="handle" />
			    <field name="product_id"/>
			    <field name="name"/>
			    <field name="quantity"/>
			    <field name="uom_id"/>
			    <field name="automatic_price"/>
			    <field name="price_unit" attrs="{'readonly': [('automatic_price', '=', True)]}"/>
			    <field name="specific_price" invisible="1"/>
			    <field name="discount" groups="sale.group_discount_per_so_line" />
			    <field name="price_subtotal"/>
			    <field name="analytic_tag_ids" widget="many2many_tags"/>
			</tree>
		    </field>
		</div>
		<notebook>
		    <page string="Facturas Emitidas">
			<field name="invoice_ids" readonly="1"/>
		    </page>
		    <page string="Configuración">
			<div>
			    <field name="recurring_invoices" class="oe_inline"/>
			    <field name="create_invoice_visibility" invisible="1"/>
			    <label for="recurring_invoices" />
			    <button name="recurring_create_invoice"
				    type="object"
				    attrs="{'invisible': ['|', ('recurring_invoices', '!=', True), ('create_invoice_visibility', '=', False)]}"
				    string="Create invoices"
				    class="oe_link"
				    groups="base.group_no_one"
				    />
			    <button name="contract.act_recurring_invoices"
				    type="action"
				    attrs="{'invisible': [('recurring_invoices','!=',True)]}"
				    string="⇒ Show recurring invoices"
				    class="oe_link"
				    />
			</div>
			<group col="4" attrs="{'invisible': [('recurring_invoices','!=',True)]}">
			    <field name="journal_id"
				   attrs="{'required': [('recurring_invoices', '=', True)]}"
				   />
			    <field name="pricelist_id"/>
			    <label for="recurring_interval"/>
			    <div>
				<field name="recurring_interval"
				       class="oe_inline"
				       attrs="{'required': [('recurring_invoices', '=', True)]}"
				       />
				<field name="recurring_rule_type"
				       class="oe_inline"
				       attrs="{'required': [('recurring_invoices', '=', True)]}"
				       />
			    </div>
			    <field name="recurring_invoicing_type"
				   attrs="{'required': [('recurring_invoices', '=', True)]}"
				   />
			    <field name="recurring_next_date"
				   attrs="{'required': [('recurring_invoices', '=', True)]}"
				   />
			</group>
		    </page>
		</notebook>
		<group name="totals" class="oe_subtotal_footer oe_right">
		    <field name="amount_invoiced"/>
		    <field name="amount_to_invoice"/>
		</group>
		</sheet>
	    </form>
	</field>
    </record>

    <record id="view_account_analytic_contract_tree" model="ir.ui.view">
	<field name="name">view.contract.extended.tree</field>
	<field name="model">account.analytic.account</field>
	<field name="arch" type="xml">
	    <tree>
		<field name="code"/>
		<field name="partner_id"/>
		<field name="date_start"/>
		<field name="date_end"/>
		<field name="active" invisible="1"/>
		<field name="amount_total"/>
		<field name="amount_invoiced"/>
		<field name="amount_to_invoice"/>
		<field name="state"/>
	    </tree>
	</field>
    </record>

    <record id="contract.action_account_analytic_overdue_all_tree" model="ir.actions.act_window.view">
	<field name="sequence" eval="1"/>
	<field name="view_mode">tree</field>
	<field name="view_id" ref="view_account_analytic_contract_tree"/>
	<field name="act_window_id" ref="contract.action_account_analytic_overdue_all"/>
    </record>

    <record id="contract.action_account_analytic_overdue_all_form" model="ir.actions.act_window.view">
	<field name="sequence" eval="2"/>
	<field name="view_mode">form</field>
	<field name="view_id" ref="view_account_analytic_contract_form"/>
	<field name="act_window_id" ref="contract.action_account_analytic_overdue_all"/>
    </record>
</odoo>
